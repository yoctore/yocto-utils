"use strict";var _=require("lodash"),crypto=require("crypto");function Crypto(t,r){this.logger=t,this.str=r}Crypto.prototype.randomizedPassword=function(t,r){r=!_.isUndefined(r)&&_.isNumber(r)&&r>=1&&r<=3?r:3,t=_.isNumber(t)&&!_.isNaN(t)&&t>=8?t:8;for(var e=3===r?Math.round(t/4):0,i=r>=2?Math.round(t/4):0,n=t-e-i,s=this.str.generateAsciiCharsList(!0,!1,!1,!0),a=this.str.generateAsciiCharsList(!1,!1,!0,!1),o=this.str.generateAsciiCharsList(!1,!0,!1,!1),p={ascii:[],special:[],num:[]},c=0;c<t;c++){if(n>0&&p.ascii.length<n){var h=(Math.random()*(s.length-1)).toFixed(0);p.ascii.push(s[h])}if(i>0&&p.num.length<i){var y=(Math.random()*(o.length-1)).toFixed(0);p.num.push(o[y])}if(e>0&&p.special.length<e){var u=(Math.random()*(a.length-1)).toFixed(0);p.special.push(a[u])}}return(p=_.shuffle(_.union(p.ascii,p.special,p.num))).join("")},Crypto.prototype.encrypt=function(t,r,e){var i=!1;try{if(_.isEmpty(t)||t.length<32)throw"Key cannot be empty and must be 32 chars length min";var n=new Buffer(t,"hex").toString();r=JSON.stringify(r);var s=crypto.createCipher(e||"aes256",n);i=s.update(r,"utf-8","hex"),i+=s.final("hex")}catch(t){this.logger.verbose(["[ Utils.Crypto.encrypt ] -",t].join(" ")),i=!1}return i},Crypto.prototype.cryptDecryptInsideArray=function(t,r,e,i){return _.isArray(r)?_.map(r,function(r){return i?this.encrypt(t,r,e):this.decrypt(t,r,e)}.bind(this)):(this.logger.warning(["[ Utils.Crypto.cryptDecryptInsideArray ] -","cryptDecryptInsideArray must be used with an Array. A",typeof r,"was given."].join(" ")),i?this.encrypt(t,r,e):this.decrypt(t,r,e))},Crypto.prototype.decrypt=function(t,r,e){var i=!1;try{if(_.isEmpty(t))throw"Key cannot be empty and must be a cypher key";var n=new Buffer(t,"hex").toString(),s=crypto.createDecipher(e||"aes256",n);i=s.update(r,"hex","utf-8"),i+=s.final("utf-8"),i=JSON.parse(i)}catch(t){this.logger.verbose(["[ Utils.Crypto.decrypt ] -",t].join(" ")),i=!1}return i},module.exports=function(t,r){return new Crypto(t,r)};