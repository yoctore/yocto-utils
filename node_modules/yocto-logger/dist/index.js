"use strict";function Logger(){this.logLevel=5,this.TYPE_CONSOLE="console",this.TYPE_DAILY_ROTATE_FILE="daily-rotate-file",this.ERROR_LOG_LEVEL={name:"error",level:1,f:"error"},this.WARNING_LOG_LEVEL={name:"warning",level:2,f:"warn"},this.INFO_LOG_LEVEL={name:"info",level:3,f:"info"},this.DEBUG_LOG_LEVEL={name:"debug",level:4,f:"debug"},this.VERBOSE_LOG_LEVEL={name:"verbose",level:5,f:"verbose"};var a=function(a,b){b=b||!1;var c={level:a.level,date:_.isFunction(a.timestamp)?a.timestamp():_.isNull(a.timestamp)?null:moment().format(),message:_.isUndefined(a.message)||_.isEmpty(a.message)?"":a.message,meta:!_.isUndefined(a.meta)&&Object.keys(a.meta).length?JSON.stringify(a.meta):""};_.has(a,"label")&&_.isFunction(a.label)&&(c.level=a.label(a.level.toLowerCase())),_.has(a,"timestamp")&&_.isFunction(a.timestamp)&&(c.date=a.timestamp()),b&&_.has(a,"colorize")&&_.isFunction(a.colorize)&&(b=a.colorize(a.level),c.level=chalk[b]("{}".format(a.label(a.level.toLowerCase()))));var d="{level} :";return _.isNull(c.date)||(d=["[{date}]",d].join(" ")),_.isUndefined(c.message)||_.isEmpty(c.message)||(d=[d,"{message}"].join(" ")),_.isUndefined(c.meta)||_.isEmpty(c.meta)||(d=[d,"{meta}"].join(" ")),d.format(c)},b=function(){return moment().format("DD/MM/YYYY HH:mm:ss")},c=function(a){var b=[{info:"info    "},{warn:"warning "},{error:"error   "},{debug:"debug   "},{verbose:"verbose "}],c=_.findIndex(b,a);return c>=0?_.first(_.values(b[c])):a},d=function(a){var b=[{info:"green"},{warn:"yellow"},{error:"red"},{debug:"blue"},{verbose:"white"}],c=_.findIndex(b,a);return c>=0?_.first(_.values(b[c])):"white"};this.consoleTransportFormatter=function(b){return a(b,!0)},this.dailyRotateFileTransportFormatter=function(b){return a(b,!1)},this.defaultConsoleTransport={level:"verbose",handleExceptions:!0,json:!1,showLevel:!0,silent:!1,label:c,formatter:this.consoleTransportFormatter,timestamp:null,colorize:d},this.defaultDailyRotateTransportFile={name:"default-daily-rotate-transport",level:"verbose",dirname:"./",filename:uuid.v4(),handleExceptions:!0,json:!1,maxsize:5242880,maxFiles:5,colorize:!0,datePattern:"-yyyy-MM-dd.log",label:c,formatter:this.dailyRotateFileTransportFormatter,timestamp:b},this.winston=new winston.Logger({transports:[new winston.transports.Console(_.clone(this.defaultConsoleTransport))],exitOnError:!1})}var winston=require("winston"),_=require("lodash"),chalk=require("chalk"),moment=require("moment"),format=require("string-format"),uuid=require("uuid"),fs=require("fs"),path=require("path");format.extend(String.prototype),winston.emitErrs=!1,Logger.prototype.addDailyRotateTransport=function(a,b,c){(_.isUndefined(a)||!_.isString(a)||_.isNull(a))&&(a="./",this.warning('[ Add New Daily Rotate Transport ] - Invalid path given. Using default path "./"')),a=path.normalize(a),a=path.resolve(a);var d=this;fs.lstat(a,function(e,f){f&&f.isDirectory()?fs.access(a,fs.F_OK|fs.R_OK|fs.W_OK,function(e){if(e)d.error(["[ Add New Daily Rotate Transport ] - Cannot read and write on",a," - operation aborted !"].join(" "));else{var f=_.clone(d.defaultDailyRotateTransportFile);_.extend(f,{dirname:a}),_.isUndefined(c)||_.isNull(c)||!_.isObject(c)||_.extend(f,c),_.isUndefined(b)||_.isEmpty(b)||_.isNull(b)||(_.isString(b)&&!_.isEmpty(b)?_.extend(f,{filename:b}):d.warning(["[ Add New Daily Rotate Transport ] - filename is not a string. retore filename to ",f.filename].join(" "))),_.isUndefined(d.winston)?console.log(chalk.red("[ Add New Daily Rotate Transport ] - Cannot add new transport. instance is invalid")):(_.has(d.winston.transports,f.name)&&(d.warning(["[ Add New Daily Rotate Transport ] - A transport with the name",f.name,"already exists. Removing current before adding new transport"].join(" ")),d.winston.remove(f.name)),d.winston.add(winston.transports.DailyRotateFile,f),b=[a,f.filename,moment().format(f.datePattern.replace(".log","").toUpperCase()),".log"].join(""),d.info(["[ Add New Daily Rotate Transport ] - Success ! Datas are logged in",b].join(" ")))}}):d.error(["[ Add New Daily Rotate Transport ] - Directory path : [",a,"] is invalid. Operation aborted !"].join(" "))})},Logger.prototype.process=function(a,b,c){var d=[this.VERBOSE_LOG_LEVEL,this.INFO_LOG_LEVEL,this.WARNING_LOG_LEVEL,this.ERROR_LOG_LEVEL,this.DEBUG_LOG_LEVEL],e=this.logLevel||5,f=e;_.each(d,function(a,b,c){_.isString(e)&&e===a.name&&(f=a.level)});_.each(d,function(d,e,g){_.isNumber(f)&&f>=a&&d.level==a&&(_.isUndefined(this.winston)||_.isNull(this.winston)||!_?console.log(chalk.red("[ Logger.process ] - Cannot une winston logger. instance is undefined or null")):_.isUndefined(c)?this.winston.log(d.f,b):this.winston.log(d.f,b,c))},this)},Logger.prototype.verbose=function(a,b){this.process(this.VERBOSE_LOG_LEVEL.level,a,b)},Logger.prototype.info=function(a,b){this.process(this.INFO_LOG_LEVEL.level,a,b)},Logger.prototype.warning=function(a,b){this.process(this.WARNING_LOG_LEVEL.level,a,b)},Logger.prototype.error=function(a,b){this.process(this.ERROR_LOG_LEVEL.level,a,b)},Logger.prototype.debug=function(a,b){this.process(this.DEBUG_LOG_LEVEL.level,a,b)},Logger.prototype.banner=function(a,b){var c={color:"white",bgColor:"bgBlack",topDelimiter:"-",bottomDelimiter:"-",leftDelimiter:"|",rightDelimiter:"|"};!_.isUndefined(b)&&_.has(b,"color")&&_.has(b,"bgColor")&&(_.startsWith("bg",b.bgColor)||(b.bgColor=["bg",_.capitalize(b.bgColor.toLowerCase())].join("")),_.extend(c,b));var d=[c.leftDelimiter,a,c.rightDelimiter].join(" ");_.has(chalk.styles,c.color)&&_.has(chalk.styles,c.bgColor)?(console.log(chalk[c.color][c.bgColor](_.repeat(c.topDelimiter,d.length))),console.log(chalk[c.color][c.bgColor](d)),console.log(chalk[c.color][c.bgColor](_.repeat(c.bottomDelimiter,d.length)))):(this.warning("[ Logger.Banner ] - Cannot use custom style given style is invalid. please read chalk documentation. Logging with current shell config."),console.log(_.repeat(c.topDelimiter,d.length)),console.log(d),console.log(_.repeat(c.bottomDelimiter,d.length)))},module.exports=new Logger;